

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Seva Data Collection & Report</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
/* (CSS is unchanged; omitted for brevity, keep as is) */
body {
font-family: 'Segoe UI', Arial, sans-serif;
background: #f5f7fb;
margin: 0;
padding-bottom: 60px; /* for footer */
}
.container {
max-width: 480px;
margin: 30px auto;
padding: 24px;
border-radius: 16px;
box-shadow: 0 4px 24px rgba(0,0,0,0.12);
background: #fff;
}
h2 {
text-align: center;
color: #2c3e50;
margin-bottom: 18px;
}
label {
display: block;
margin-top: 16px;
margin-bottom: 6px;
font-weight: 500;
color: #34495e;
}
.required {
color: #e74c3c;
font-size: 0.95em;
margin-left: 4px;
}
input, select {
width: 100%;
padding: 10px;
border: 1px solid #ccc;
border-radius: 7px;
box-sizing: border-box;
font-size: 1em;
}
input[type="date"] {
color-scheme: light;
}
input:focus, select:focus {
border-color: #4787ff;
outline: none;
}
button {
width: 100%;
margin-top: 25px;
padding: 12px;
font-size: 1.05em;
background: linear-gradient(90deg, #4787ff 30%, #59caea 100%);
border: none;
border-radius: 7px;
color: #fff;
font-weight: 600;
cursor: pointer;
transition: background 0.2s;
}
button:hover { background: #356be0; }
#responseMsg {
margin-top: 24px;
text-align: center;
font-weight: 600;
}
.field-group {
margin-top: 0;
margin-bottom: 0;
}
.hidden { display: none; }
hr { margin: 24px 0 12px 0; border-color:#cfd2d6; }
/* Footer */
footer {
position: fixed;
left: 0; bottom: 0; width: 100%;
background: #fff;
border-top: 1px solid #ccc;
box-shadow: 0 -2px 6px rgba(0,0,0,0.1);
display: flex;
justify-content: center;
gap: 12px;
padding: 10px 0;
z-index: 1000;
}
footer button {
width: auto;
min-width: 130px;
padding: 10px 24px;
font-size: 1em;
background: #4787ff;
border-radius: 40px;
font-weight: 600;
}
footer button:disabled {
background: #a2bdfc;
cursor: not-allowed;
}
/* Report table */
#reportDiv table {
border-collapse: collapse;
width: 100%;
max-width: 480px;
margin: 10px auto;
}
#reportDiv th, #reportDiv td {
border: 1px solid #ccc;
padding: 6px 10px;
font-size: 0.9em;
}
#reportDiv th {
background: #4787ff;
color: white;
}
/* Responsive */
@media(max-width: 600px) {
.container {
padding: 13px;
margin: 20px auto;
}
h2 {
font-size: 1.1em;
}
footer {
gap: 8px;
}
footer button {
min-width: 110px;
padding: 8px 16px;
font-size: 0.95em;
}
}
h4 {text-align:center;}
.dtsb {background:black; color:white;padding-right:10px;}
.dtsr {background:red ; color:white;padding-right:10px;}
</style>
</head>
<body>
<!-- Instructions Section -->
<div id="instructionsSection" class="container">
<h4>Welcome to Seva Data Collection</h4>
<p>
Please use the buttons below to enter data or view the report.<br />
<strong>Instructions:</strong><br />
- Fill in the form carefully.<br />
- Mobile number must start with 6,7,8, or 9 and be 10 digits.<br />
- If "Other" is selected in relationship, specify the relationship.<br />
- Date of Seva is between 7th Sep and 21st Sep 2025.<br />
- Provide 3 days time for processing.<br />
- Optionally, add second Pitru 2 details; if any second Pitru field is filled, all must be completed.<br />
-Data Entry is now open for <span id='entryclose'> </span> onwards. Will close on 18-Sep-2025
</p>
</div>
<!-- Data Entry Section -->
<div id="dataEntrySection" class="container hidden" >
<h2>Seva Data Collection</h2>
<form id="dataForm" autocomplete="off">
<label>Mobile Number <span class="required">*</span>
<input type="tel" name="mobile" id="mobile" required pattern="^[6-9][0-9]{9}$" maxlength="10" placeholder="Enter 10 digit mobile number" />
</label>
<label>Name of the sponsor <span class="required">*</span>
<input type="text" name="sponsor_name" required />
</label>
<label>Gotra of the sponsor <span class="required">*</span>
<input type="text" name="sponsor_gotra" required />
</label>
<label>Name of the co-sponsor (Optional)
<input type="text" name="co_sponsor_name" />
</label>
<label>Gotra of co-sponsor (Optional)
<input type="text" name="co_sponsor_gotra" />
</label>
<label>Name of Pitru1 <span class="required">*</span>
<input type="text" name="pitru1_name" required />
</label>
<label>Gotra of Pitru1 <span class="required">*</span>
<input type="text" name="pitru1_gotra" required />
</label>
<label>Relationship <span class="required">*</span>
<select name="relationship" id="relationship" required>
<option value="">Select</option>
<option value="father">Father</option>
<option value="mother">Mother</option>
<option value="other">Other</option>
</select>
</label>
<div id="relationshipOtherDiv" class="field-group hidden">
<input type="text" id="relationshipOtherInput" placeholder="Enter relationship" />
</div>
<label>Date of Seva <span class="required">*</span> Min <span id='min1'>15-Sep-2025 </span> Max 21-Sep-2025
<input type="date" name="date_of_seva" id='date_of_seva' min="2025-09-15" max="2025-09-21" required />
</label>
<hr />
<label>Name of Pitru2 (Optional)
<input type="text" name="pitru2_name" id="pitru2_name" />
</label>
<label>Gotra of Pitru2 (Optional)
<input type="text" name="pitru2_gotra" id="pitru2_gotra" />
</label>
<label>Relationship (Optional)
<select name="relationship2" id="relationship2">
<option value="">Select</option>
<option value="father">Father</option>
<option value="mother">Mother</option>
<option value="other">Other</option>
</select>
</label>
<div id="relationship2OtherDiv" class="field-group hidden">
<input type="text" id="relationship2OtherInput" placeholder="Enter relationship" />
</div>
<!-- REMOVED: Date of Seva (Optional) for Pitru2 -->
<button type="submit">Submit</button>
</form>
<div id="responseMsg"></div>
</div>
<!-- Report Section -->
<div id="reportSection" class="container hidden">
<h2>Seva Data Report</h2>
<div>
<input type="text" id="inputSearch" placeholder="Search report..." style="width: 100%; padding: 8px; margin-bottom: 12px; font-size: 1em; box-sizing: border-box;" />
</div>
<div id="reportDiv">
<!-- Report table will be injected here -->
</div>
</div>
<!-- Footer with navigation buttons -->
<footer>
<button id="btnShowInstructions" type="button">Show Instructions</button>
<button id="btnShowDataEntry" type="button">Show Data Entry</button>
<button id="btnShowReport" type="button" disabled>Show Report</button>
</footer>
<script>
ddmmyy = (input) => new Date(input).toLocaleString("en-GB", { timeZone: "Asia/Kolkata" }).substring(0,10)
today = new Date()
// today = new Date(2025,08,19)
//fixedmindate= new Date(2025,08,04)
//newmindate = today >= fixedmindate ? new Date(today.getTime() + (86400000)*4).toISOString().split("T")[0] : "2025-09-07"
//document.getElementById('date_of_seva').min = newmindate
// REMOVED: document.getElementById('date_of_seva2').min = newmindate
//document.getElementById('min1').innerHTML= newmindate
// REMOVED: document.getElementById('min2').innerHTML= newmindate
//document.getElementById('entryclose').innerHTML= newmindate
const scriptURL = 'https://script.google.com/macros/s/AKfycbzT7quKfsC8YCJoTJbS7hDW7q76UHg4IWjd2OFKckl0B8NXnPFgw92NTP7_a9I-X8dn/exec';
// Cached report data
let cachedReport = null;
// Sections
const instructionsSection = document.getElementById('instructionsSection');
const dataEntrySection = document.getElementById('dataEntrySection');
const reportSection = document.getElementById('reportSection');
// Footer buttons
const btnShowInstructions = document.getElementById('btnShowInstructions');
const btnShowDataEntry = document.getElementById('btnShowDataEntry');
const btnShowReport = document.getElementById('btnShowReport');
// Show/hide section utility
function showSection(name) {
instructionsSection.classList.add('hidden');
dataEntrySection.classList.add('hidden');
reportSection.classList.add('hidden');
if (name === 'instructions') instructionsSection.classList.remove('hidden');
else if (name === 'dataEntry') dataEntrySection.classList.remove('hidden');
else if (name === 'report') reportSection.classList.remove('hidden');
}
// Show instructions by default
showSection('instructions');
// Enable show report button only if cachedReport is not null (data exists)
function updateReportButtonState() {
btnShowReport.disabled = !cachedReport;
}
// Relationships Other field toggles
const relationship = document.getElementById('relationship');
const relationshipDiv = document.getElementById('relationshipOtherDiv');
const relationshipInput = document.getElementById('relationshipOtherInput');
relationship.addEventListener('change', () => {
if (relationship.value === 'other') {
relationshipDiv.classList.remove('hidden');
relationshipInput.required = true;
} else {
relationshipDiv.classList.add('hidden');
relationshipInput.required = false;
relationshipInput.value = '';
}
});
const relationship2 = document.getElementById('relationship2');
const relationship2Div = document.getElementById('relationship2OtherDiv');
const relationship2Input = document.getElementById('relationship2OtherInput');
relationship2.addEventListener('change', () => {
if (relationship2.value === 'other') {
relationship2Div.classList.remove('hidden');
relationship2Input.required = true;
} else {
relationship2Div.classList.add('hidden');
relationship2Input.required = false;
relationship2Input.value = '';
}
});
// Show Instructions button click
btnShowInstructions.addEventListener('click', () => {
showSection('instructions');
});
// Show Data Entry button click
btnShowDataEntry.addEventListener('click', () => {
showSection('dataEntry');
clearResponseMsg();
});
// Show Report button click - fetch report if not cached
btnShowReport.addEventListener('click', () => {
if (!cachedReport) {
loadReport();
} else {
renderReport(cachedReport);
showSection('report');
}
});
// Clear response message
function clearResponseMsg() {
const msgEl = document.getElementById('responseMsg');
msgEl.innerText = '';
}
// Show message helper
function showMsg(msg, isError) {
const el = document.getElementById('responseMsg');
el.style.color = isError ? '#e74c3c' : '#27ae60';
el.innerText = msg;
}
// Load report from API
function loadReport() {
btnShowReport.disabled = true;
btnShowReport.innerText = 'Loading...';
fetch(scriptURL)
.then(res => res.json())
.then(data => {
cachedReport = data;
renderReport(data);
showSection('report');
})
.catch(err => {
alert('Error loading report data. Try again later.');
})
.finally(() => {
btnShowReport.innerText = 'Show Report';
updateReportButtonState();
});
}
// Render report HTML table
function renderReport(data) {
const reportDiv = document.getElementById('reportDiv');
if (!data || data.length === 0) {
reportDiv.innerHTML = '<p>No data available.</p>';
return;
}
reportDiv.innerHTML = ''; // clear current content
data.forEach(item => {
const div = document.createElement('div');
div.className = 'report-item';
div.style.border = '1px solid #ccc';
div.style.borderRadius = '8px';
div.style.padding = '12px 16px';
div.style.marginBottom = '12px';
div.style.background = '#fff';
div.style.boxShadow = '0 1px 6px rgba(0,0,0,0.08)';
div.style.whiteSpace = 'pre-wrap';
let content =
`Entry Date: ${ddmmyy(item.Timestamp)}
Mobile: ${item.Mobile || ''}
Sponsor Name: ${item["Sponsor Name"] || ''}
Sponsor Gotra: ${item["Sponsor Gotra"] || ''}
Co Sponsor Name: ${item["Co Sponsor Name"] || 'NIL'}
Co Sponsor Gotra: ${item["Co Sponsor Gotra"] || 'NIL'}
<span class='dtsb'>Date of Seva: ${ddmmyy(item["Date of Seva"]) || ''}</span>
Pitru1 Name: ${item["Pitru1 Name"] || ''}
Pitru1 Gotra: ${item["Pitru1 Gotra"] || ''}
Relationship: ${item.Relationship || ''}`;
if (item["Pitru2 Name"] || item["Pitru2 Gotra"] || item.Relationship2) {
// REMOVED date_of_seva2/Date of Seva2 line
content +=
`
Pitru2 Name: ${item["Pitru2 Name"] || ''}
Pitru2 Gotra: ${item["Pitru2 Gotra"] || ''}
Relationship2: ${item.Relationship2 || ''}
`;
}
div.innerHTML = content;
reportDiv.appendChild(div);
});
}
// Filter function to hide/show items based on search
document.getElementById('inputSearch').addEventListener('input', function() {
const filter = this.value.trim().toLowerCase();
const items = document.getElementById('reportDiv').getElementsByClassName('report-item');
Array.from(items).forEach(item => {
const text = item.textContent.toLowerCase();
item.style.display = text.includes(filter) ? '' : 'none';
});
});
// Handle form submission
document.getElementById('dataForm').addEventListener('submit', function(e) {
e.preventDefault();
clearResponseMsg();
// Mobile validation
const mobile = document.getElementById('mobile').value.trim();
const mobilePattern = /^[6-9][0-9]{9}$/;
if (!mobilePattern.test(mobile)) {
showMsg('Enter valid 10-digit mobile number starting with 6/7/8/9', true);
return;
}
// Pitru1 relationship
let relValue = relationship.value;
if (relValue === 'other') {
relValue = relationshipInput.value.trim();
if (!relValue) {
showMsg('Please specify the relationship for Pitru1', true);
return;
}
}
// Pitru2 group
const pitru2 = this.pitru2_name.value.trim();
const pitru2_gotra = this.pitru2_gotra.value.trim();
let relValue2 = relationship2.value;
if (relValue2 === 'other') {
relValue2 = relationship2Input.value.trim();
if (!relValue2) {
showMsg('Please specify the relationship for Pitru2', true);
return;
}
}
// REMOVED:
// const date2 = this.date_of_seva2.value;
// Validate optional Pitru2 group all or none filled
if ((pitru2 || pitru2_gotra || relValue2) 
   && (!pitru2 || !pitru2_gotra || !relValue2)) {
showMsg('If any optional second Pitru field is filled, you must enter name, gotra, and relationship.', true);
return;
}
// Assemble form data
const formData = new FormData();
formData.append('mobile', mobile);
formData.append('sponsor_name', this.sponsor_name.value.trim());
formData.append('sponsor_gotra', this.sponsor_gotra.value.trim());
formData.append('co_sponsor_name', this.co_sponsor_name.value.trim());
formData.append('co_sponsor_gotra', this.co_sponsor_gotra.value.trim());
formData.append('pitru1_name', this.pitru1_name.value.trim());
formData.append('pitru1_gotra', this.pitru1_gotra.value.trim());
formData.append('relationship', relValue);
formData.append('date_of_seva', this.date_of_seva.value);
formData.append('pitru2_name', pitru2);
formData.append('pitru2_gotra', pitru2_gotra);
formData.append('relationship2', relValue2);
// REMOVED: formData.append('date_of_seva2', date2);
// Disable submit button during submission
const submitBtn = this.querySelector('button[type="submit"]');
submitBtn.disabled = true;
submitBtn.innerText = 'Submitting...';
fetch(scriptURL, { method: 'POST', body: formData })
.then(response => response.text())
.then(data => {
showMsg('Submission Successful!', false);

this.reset();
relationshipDiv.classList.add('hidden');
relationship2Div.classList.add('hidden');
// Update cachedReport by appending the new record so report reflects fresh data
const newEntry = {
Timestamp: new Date(),
Mobile: mobile,
"Sponsor Name": formData.get('sponsor_name'),
"Sponsor Gotra": formData.get('sponsor_gotra'),
"Co Sponsor Name": formData.get('co_sponsor_name'),
"Co Sponsor Gotra": formData.get('co_sponsor_gotra'),
"Pitru1 Name": formData.get('pitru1_name'),
"Pitru1 Gotra": formData.get('pitru1_gotra'),
Relationship: relValue,
"Date of Seva": formData.get('date_of_seva'),
"Pitru2 Name": formData.get('pitru2_name'),
"Pitru2 Gotra": formData.get('pitru2_gotra'),
Relationship2: formData.get('relationship2')
// REMOVED: , "Date of Seva2": formData.get('date_of_seva2'),
};
if (!cachedReport) cachedReport = [];
cachedReport.push(newEntry);
sub()
updateReportButtonState();
})
.catch(error => {
console.error('Error!', error);
showMsg('Error! Try again later.', true);
})
.finally(() => {
submitBtn.disabled = false;
submitBtn.innerText = 'Submit';
});
});
// Initialize report button state on page load (disabled, no data yet)
updateReportButtonState();
function initializeReportData() {
fetch(scriptURL)
.then(res => res.json())
.then(data => {
if (data && data.length > 0) {
cachedReport = data;
} else {
cachedReport = null;
}
updateReportButtonState();
})
.catch(err => {
// Optional: handle fetch error gracefully, keep report button disabled
console.error("Failed to fetch data on load:", err);
cachedReport = null;
updateReportButtonState();
});
}
initializeReportData()
updateReportButtonState();


function sub(){
data={date:'30/10/1960', sponsor:'rao', sponsorGotra:'bahar', coSponsor:'sund',
coSponsorGotra:'bhar',mobile:99890, pitruNames:'gkm', pitruGotras:'bha', 
relationship:'fa'}

msg = `🕉️ SEVA 24 Details 🕉️%0A
📅 Date: ${data.date}%0A
👤 Sponsor: ${data.sponsor} (${data.sponsorGotra})%0A
🤝 Co-Sponsor: ${data.coSponsor} (${data.coSponsorGotra})%0A
📱 Mobile: ${data.mobile}%0A
🙏 Pitru Devatas: ${data.pitruNames}%0A
🔸 Gotras: ${data.pitruGotras}%0A
👨‍👩‍👧‍👦 Relationship: ${data.relationship}`;

        // OPEN WHATSAPP
        const waUrl = `https://wa.me/919989036183?text=${msg}`;
        window.open(waUrl, "_blank");
}

</script>
</body>
</html>
