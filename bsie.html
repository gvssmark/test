
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, maximum-scale=1 , initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family='Lucida Console'&effect=neon|outline|emboss|shadow-multiple">
    <title>IBRA-Accounts</title>

            <style>
            table.acdata,  {width:95%; margin:0 auto;}
            table {width:95%; margin:0 auto;}
table, tr, td {border:1px solid black; border-collapse: collapse;1width:90%; margin-top:-15px;}
.acdata {font-size:small}
body {font-family:'Lucida Console'}
td.sfont {font-size:xx-small}
@media only screen and (min-width: 400px) {
  body {
    background-color: lightblue;
    width:360px;
    margin: auto
  }}
</style></head>
<body>
<h3 align=center id='year'>Ledger</h3>
<div id="tdata" style="1width:360px;  ; margin:0 auto;  ; align-items: center"></div>
<br><br>
<div id="acts" style="1width:360px;  ; margin:0 auto;  ; align-items: center">.</div>
<script>
String.prototype.toTitle = function() {  return this.toLowerCase().replace(/(^|\s)\S/g, function(t) { return t.toUpperCase() });}
url = 'https://script.google.com/macros/s/AKfycbyM8VvTakfBAu16BnGsYoUZwHPnUW7dHiJs_Cg40VGxXI2cAOk/exec'
            async function getMyData() {
                response = await fetch(url)
                data = await response.json()
                tempData1 = data["jrnldata"]
                bsyear = tempData1[0].dt
                tempData = tempData1.filter(a => a.amt!=0)
document.getElementById("year").innerHTML = "Ledger for " + bsyear
getActData()}
acturl = 'https://script.google.com/macros/s/AKfycbxg1OCW2FO6NzNvkFOUnIs4U3LE4DI0dCNgnrL5yQEWlgg1uaE/exec'
            async function getActData() {
                response = await fetch(acturl)
                data1 = await response.json()
                actData = data1["acctsdata"]
                actData = actData.filter(a => a.bal !=0 & a.acno !=2003 & a.acno>0);
        accts()  }
getMyData() 
function accts(){
tabledata= "<br><table class='accts'  align=center border=1 ><table width=95% align=center ><tr style='background:black; color:white; text-align:center; '><td>AcNo<td >Ac Name<td >Balance"
actData.forEach(a=> {tabledata+= `<tr  id=${a.acno}><td>${a.acno} <td>${a.acname.toTitle()}<td align=right>${a.bal}`})
tabledata += "</table>"
document.getElementById("tdata").innerHTML = tabledata
rows = document.getElementsByTagName('tr')
Array.from(rows).forEach((row) => {
  row.addEventListener('click', () => {
filterac(row.id)});
});
}

function filterac(acno){
acno= +acno
actname = actData.filter(a=> a.acno === acno)[0].acname
filtered =  tempData.filter(o => {return (o.drac == acno || o.crac == acno)}).map(a => ({ dt: gdt(a.dt), details: a.trdetail, drac: a.drac, crac: a.crac, amt: a.amt }));
acdata=`<table border=1 class='acdata' >`
           Math.floor(acno/1000) %2 ? (balance = filtered[0].amt*-1, dc="Dr"): (balance = filtered[0].amt, dc="Cr")
           acdata += `<tr ><td  colspan=5 align=center bgcolor=yellow>${ actname}<tr style='background:black; color:white; text-align:center; '><td>Date<td>Details<td>DC<td>Amt<td>Bal`
           acdata += "<tr><td>" + filtered[0].dt + "<td class='sfont'>"+filtered[0].details +"<td>"+dc+"<td align=right>" + filtered[0].amt+"<td align=right>"+balance 
           for (i=1; i<filtered.length; i++){
                      filtered[i].drac == acno ? balance = balance - filtered[i].amt : balance = balance + filtered[i].amt
                      filtered[i].drac == acno ? dc = "Dr": dc="Cr"
                      acdata += "<tr><td>"+filtered[i].dt+"<td class='sfont'>"+ filtered[i].details.toString().toTitle()+"<td>"+dc+"<td align=right>"+filtered[i].amt+"<td align=right>"+balance
           }
          document.getElementById("acts").innerHTML = acdata
}
function gdt (d){
           mm  = (new Date(d).getMonth()*1+1).toString().padStart(2,0)
           dd  = new Date(d).getDate().toString().padStart(2,0)
           yyyy= new Date(d).getFullYear()-2000
           return dd+"/"+mm+"/"+yyyy
}
</script>
</body>
</html>

